(()=>{"use strict";class e{constructor(){if(this.constructor===e)throw new TypeError("Abstract class 'Form' cannot be instantiated directly.");window.addEventListener("load",this.handleLoad.bind(this))}get(){return this.field}createField(){const e=document.createElement("div");return e.classList.add("mio-field"),""!==this.input.value&&e.classList.add("active"),this.error&&e.classList.add("error"),e}createWrapper(){const e=document.createElement("div");return e.classList.add("mio-wrapper"),e}createLabel(){const e=document.createElement("label");return e.classList.add("mio-label"),e.textContent=this.label.text,e.htmlFor=this.label.for,e}createAdornment(e,t){return this.adornmentEl=document.createElement("div"),this.adornmentEl.classList.add("mio-adornment"),this.adornmentEl.classList.add(t),this.adornmentEl.appendChild(e),this.field.classList.add(`${t}-adornment`),this.adornmentEl}createMessage(){if(this.message)return this.messageEl=document.createElement("div"),this.messageEl.classList.add("mio-message"),this.error&&this.messageEl.classList.add("mio-error"),this.messageEl.textContent=this.message,this.messageEl}removeMessage(){this.messageEl&&(this.messageEl.remove(),this.error&&(this.field.classList.remove("error"),this.messageEl.classList.remove("mio-error")))}getValue(){return this.input.value}setValue(e){this.input.value=e,this.inputEl.value=e,this.field.classList.add("active"),this.removeMessage()}handleLoad(){this.field.querySelector("input:-webkit-autofill")&&this.field.classList.add("active")}handleBlur(){this.inputEl.value||this.field.classList.remove("active"),this.field.classList.remove("focus"),this.onBlur&&this.onBlur(this.inputEl.value)}handleFocus(){this.field.classList.add("active"),this.field.classList.add("focus")}handleInput(){this.manualErrorHandling||this.removeMessage(),this.onInput&&this.onInput(this.inputEl.value)}showError(e){this.error=!0,this.message=e,this.field.classList.add("error"),this.field.appendChild(this.createMessage())}removeError(){this.error=!1,this.message=null,this.field.classList.remove("error"),this.removeMessage()}showAdornment(e){this.adornment=e,this.wrapper.appendChild(this.createAdornment())}removeAdornment(){this.adornmentEl&&(this.adornment=null,this.adornmentEl.remove())}focus(){this.inputEl.focus()}blur(){this.inputEl.blur()}clear(){this.input.value="",this.inputEl.value="",this.field.classList.remove("active"),this.removeError()}}const t=e,s=class{constructor(e){Object.assign(this,e),this.init()}init(){this.iconButton=this.create()}get(){return this.iconButton}create(){const e=document.createElement("button");switch(e.type=this.type??"button",e.ariaLabel=this.ariaLabel??"",e.classList.add("mio-icon-btn"),this.buttonSize){case"small":e.classList.add("btn-size-small");break;case"medium":e.classList.add("btn-size-medium");break;case"large":e.classList.add("btn-size-large");break;case"xl":e.classList.add("btn-size-xl");break;default:e.classList.add("btn-medium-small")}switch(this.svgSize){case"xs":e.classList.add("svg-size-xs");break;case"small":e.classList.add("svg-size-small");break;case"medium":default:e.classList.add("svg-size-medium");break;case"large":e.classList.add("svg-size-large");break;case"xl":e.classList.add("svg-size-xl")}return e.addEventListener("click",(e=>{e.stopPropagation(),this.onClick()})),e.appendChild(this.icon),e}},i=(()=>{const e=[{name:"chevron-right",paths:[{fillRule:"evenodd",d:"M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"}]},{name:"chevron-left",paths:[{fillRule:"evenodd",d:"M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"}]},{name:"calendar",paths:[{d:"M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"}]},{name:"calendar-heart",paths:[{fillRule:"evenodd",d:"M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4V.5ZM1 14V4h14v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1Zm7-6.507c1.664-1.711 5.825 1.283 0 5.132-5.825-3.85-1.664-6.843 0-5.132Z"}]},{name:"arrow-left",paths:[{fillRule:"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"}]}];return{get:t=>{const s=e.find((e=>e.name===t));return s?(e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("width",`${e.width||16}`),t.setAttribute("height",`${e.height||16}`),t.setAttribute("fill","currentColor"),t.setAttribute("viewBox",`0 0 ${e.width||16} ${e.height||16}`),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.paths.forEach((e=>{const s=document.createElementNS("http://www.w3.org/2000/svg","path");e.fillRule&&s.setAttribute("fill-rule",e.fillRule),s.setAttribute("d",e.d),t.appendChild(s)})),t})(s):null}}})(),a=e=>e instanceof Date&&!isNaN(e),r=(e,t)=>{const s=new Date(e,t,1),i=[];for(;s.getMonth()===t;)i.push(new Date(s)),s.setDate(s.getDate()+1);return i},n=(e,t)=>new Date(e,t,1),d=(e,t)=>new Date(e,t+1,0),l=(e,t)=>[...Array(7).keys()].map((s=>new Date(0,0,s+1).toLocaleDateString(e,{weekday:t}))),h=e=>e.getDay()?e.getDay():7,c=e=>new Date(e.getFullYear(),e.getMonth(),e.getDate()),o=e=>e.toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit"}),u=e=>e.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),p=class extends t{constructor(e){super(e),Object.assign(this,e),this.isOpen=!1,this.create()}create(){this.field=this.createField(),this.wrapper=this.createWrapper(),this.labelEl=this.createLabel(),this.inputEl=this.createInput(),this.field.appendChild(this.wrapper),this.wrapper.appendChild(this.labelEl),this.wrapper.appendChild(this.inputEl),this.message&&!this.manualErrorHandling&&this.field.appendChild(this.createMessage());const e=new s({type:"button",ariaLabel:"Icono calendario",buttonSize:"medium",svgSize:"medium",icon:i.get("calendar-heart"),onClick:()=>{this.inputEl.focus()}}).get();this.wrapper.appendChild(this.createAdornment(e,"right"))}createInput(){const e=document.createElement("input");return e.classList.add("mio-input"),e.type="text",e.name=this.input.name,e.id=this.input.id,e.value=this.formatValue(),this.input.placeholder&&(e.placeholder=this.input.placeholder),this.input.readOnly&&(e.readOnly=!0),this.input.maxLength&&(e.maxLength=this.input.maxLength),e.addEventListener("focus",this.handleFocus.bind(this)),e}handleFocus(){this.field.classList.add("active"),this.field.classList.add("focus"),this.onFocus&&this.onFocus()}handleBlur(){this.input.value||this.field.classList.remove("active"),this.field.classList.remove("focus"),this.onBlur&&this.onBlur()}setValue(e){this.input.value=e,this.inputEl.value=this.formatValue(),this.field.classList.add("active"),this.removeMessage()}formatValue(){let e=new Date(this.input.value);return a(e)?"short"===this.input.format?o(e):"long"===this.input.format?u(e):void 0:""}},m=e=>e[0].toUpperCase()+e.slice(1),g=async e=>new Promise((t=>{e.addEventListener("animationend",t,{once:!0})})),v={date:""},y={date:""},D=document.querySelector(".container"),L=document.createElement("form");L.classList.add("mio-form"),D.appendChild(L);const w=new class{constructor(e){Object.assign(this,e),this.init()}init(){this.inputDate=new p({label:this.label,input:this.input,error:this.error,message:this.message,onFocus:()=>{this.panel.open(),this.daypicker.render(),this.panel.render(this.daypicker.get())},onBlur:()=>{}}),this.panel=new class{constructor(e){Object.assign(this,e),this.isOpen=!1,this.isClose=!1}async open(){this.isOpen||(this.isOpen=!0,this.datepicker=this.create(),document.body.appendChild(this.datepicker),this.onOpen(),this.position(),this.datepicker.classList.add("in"),await g(this.datepicker))}render(e){this.datepicker.firstChild.appendChild(e)}create(){const e=document.createElement("div");e.classList.add("datepicker"),e.addEventListener("mousedown",this.checkClose.bind(this)),e.addEventListener("touchstart",this.checkClose.bind(this),{passive:!0}),e.addEventListener("click",(()=>{this.isClose&&this.close()})),this.resize=this.handleResize.bind(this),window.addEventListener("resize",this.resize);const t=document.createElement("div");return t.classList.add("content"),t.addEventListener("click",(e=>e.stopPropagation())),e.appendChild(t),e}position(){document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&document.body.classList.add("noscroll");const e=this.input.get(),t=e.getBoundingClientRect();innerWidth<768?this.datepicker.firstChild.removeAttribute("style"):(this.datepicker.firstChild.style.top=`${t.top+e.offsetHeight+2}px`,this.datepicker.firstChild.style.left=`${t.left}px`,this.datepicker.firstChild.style.width=`${t.width}px`)}checkClose(e){e.target===this.datepicker&&(this.isClose=!0)}async close(){this.isOpen=!1,this.isClose=!1,document.body.classList.remove("noscroll"),this.datepicker.classList.add("out"),await g(this.datepicker),this.onClose(),this.destroy()}handleResize(){this.position()}destroy(){window.removeEventListener("resize",this.resize),this.datepicker.remove()}}({input:this.inputDate,onOpen:()=>{this.inputDate.blur()},onClose:()=>{this.inputDate.handleBlur(),this.dates.resetCurrentDate(),this.dates.resetDates(),this.years.setSelectedYear(this.dates.selectedDate),this.years.resetYears()}}),this.dates=new class{constructor(e){Object.assign(this,e),this.dates=[],this.todayDate=null,this.currentDate=null,this.selectedDate=null,this.init()}init(){this.initDates(),this.setDates()}initDates(){this.todayDate=c(new Date),this.currentDate=c(new Date),this.selectedDate=c(new Date);const e=new Date(this.value);a(e)&&(this.currentDate=c(e),this.selectedDate=c(e)),this.currentDate.setDate(1)}setCurrentDate(e){this.currentDate=c(new Date(e)),this.currentDate.setDate(1)}setSelectedDate(e){this.selectedDate=c(new Date(e))}prevCurrentDateMonth(){this.currentDate.setMonth(this.currentDate.getMonth()-1)}nextCurrentDateMonth(){this.currentDate.setMonth(this.currentDate.getMonth()+1)}setCurrentDateYear(e){this.currentDate.setFullYear(e.getFullYear())}resetCurrentDate(){this.currentDate=c(new Date(this.selectedDate)),this.currentDate.setDate(1)}resetDates(){this.clear(),this.setDates()}setDates(){const e=this.currentDate.getFullYear(),t=this.currentDate.getMonth(),s=new Date(e,t-1),i=new Date(e,t+1),a=s.getMonth(),l=s.getFullYear(),c=i.getMonth(),o=i.getFullYear(),u=r(l,a),p=r(e,t),m=r(o,c),g=n(e,t),v=d(e,t),y=h(g),D=h(v);for(let e=u.length-y+1;e<u.length;e++)this.addDate(u[e]);for(let e=0;e<p.length;e++)this.addDate(p[e]);for(let e=0;e<7-D;e++)this.addDate(m[e]);if(this.dates.length<42)for(let e=0;e<7;e++)this.addDate(m[e+7]);this.dates=this.dates.map((e=>({date:e,isPrev:e.getMonth()<t,isToday:e.getTime()===this.todayDate.getTime(),isSelected:e.getTime()===this.selectedDate.getTime(),isCurrent:e.getMonth()===t,isNext:e.getMonth()>t})))}addDate(e){this.dates=[...this.dates,e]}clear(){this.dates=[]}}({value:this.input.value}),this.years=new class{constructor(e){Object.assign(this,e),this.years=[],this.todayYear=null,this.selectedYear=null,this.init()}init(){this.initYears(),this.setYears()}initYears(){this.todayYear=c(new Date),this.selectedYear=c(new Date);const e=new Date(this.value);a(e)&&(this.selectedYear=c(new Date(e)))}setSelectedYear(e){this.selectedYear=new Date(e)}resetYears(){this.clear(),this.setYears()}setYears(){for(let e=1900;e<=2100;e++){const t=new Date(e,0,1);this.addYear(t)}this.years=this.years.map((e=>({year:e,isSelected:e.getFullYear()===this.selectedYear.getFullYear(),isToday:e.getFullYear()===this.todayYear.getFullYear()})))}addYear(e){this.years=[...this.years,e]}clear(){this.years=[]}}({value:this.input.value}),this.daypicker=new class{constructor(e){Object.assign(this,e),this.isSlide=!1}init(){this.daypicker=this.create()}get(){return this.daypicker}render(){this.destroy(),this.init()}create(){const e=document.createElement("div");e.classList.add("daypicker");const t=document.createElement("div");t.classList.add("header"),e.appendChild(t);const a=new s({type:"button",ariaLabel:"Mes anterior",buttonSize:"large",svgSize:"large",icon:i.get("chevron-left"),onClick:()=>{this.isSlide||this.onPrevMonth()}});t.appendChild(a.get()),this.date=this.createDate(),t.appendChild(this.date);const r=new s({type:"button",ariaLabel:"Mes siguiente",buttonSize:"large",svgSize:"large",icon:i.get("chevron-right"),onClick:()=>{this.isSlide||this.onNextMonth()}});t.appendChild(r.get());const n=this.createWeekdays();return e.appendChild(n),this.slide=document.createElement("div"),this.slide.classList.add("slide"),e.appendChild(this.slide),this.currentDays=this.createDays(),this.slide.appendChild(this.currentDays),e}createDate(){const e=document.createElement("button");e.classList.add("date");const t=this.dates.currentDate.toLocaleDateString("es-ES",{month:"long",year:"numeric"});return e.textContent=m(t),e.addEventListener("click",(()=>this.onSelectYear())),e}createWeekdays(){const e=document.createElement("div");return e.classList.add("weekdays"),l("es-ES","narrow").forEach((t=>{const s=document.createElement("div");s.classList.add("weekday"),s.textContent=t,e.appendChild(s)})),e}createDays(){const e=document.createElement("div");return e.classList.add("days"),this.dates.dates.forEach((t=>{const s=document.createElement("div");s.classList.add("day"),e.appendChild(s);const i=document.createElement("button");t.isPrev&&i.classList.add("prev"),t.isCurrent&&i.classList.add("current"),t.isToday&&i.classList.add("today"),t.isSelected&&i.classList.add("selected"),t.isNext&&i.classList.add("next"),i.addEventListener("click",(()=>this.onSelectDate(t.date))),s.appendChild(i);const a=document.createElement("div");a.classList.add("number"),a.textContent=t.date.getDate(),i.appendChild(a)})),e}async prev(){this.isSlide=!0,this.prevDate=this.createDate(),this.date.replaceWith(this.prevDate),this.date=this.prevDate,this.slide.classList.add("left"),this.prevDays=this.createDays(),this.prevDays.classList.add("slide-right"),this.slide.appendChild(this.prevDays),this.currentDays.classList.add("slide-right"),await g(this.currentDays),this.currentDays.remove(),this.currentDays=this.prevDays,this.slide.classList.remove("left"),this.currentDays.classList.remove("slide-right"),this.isSlide=!1}async next(){this.isSlide=!0,this.nextDate=this.createDate(),this.date.replaceWith(this.nextDate),this.date=this.nextDate,this.nextDays=this.createDays(),this.nextDays.classList.add("slide-left"),this.slide.appendChild(this.nextDays),this.currentDays.classList.add("slide-left"),await g(this.currentDays),this.currentDays.remove(),this.currentDays=this.nextDays,this.currentDays.classList.remove("slide-left"),this.isSlide=!1}destroy(){this.daypicker&&this.daypicker.remove()}}({dates:this.dates,onPrevMonth:()=>{this.dates.clear(),this.dates.prevCurrentDateMonth(),this.dates.setDates(),this.daypicker.prev()},onNextMonth:()=>{this.dates.clear(),this.dates.nextCurrentDateMonth(),this.dates.setDates(),this.daypicker.next()},onSelectYear:()=>{this.daypicker.destroy(),this.yearpicker.render(),this.panel.render(this.yearpicker.get())},onSelectDate:e=>{this.inputDate.setValue(e),this.dates.setCurrentDate(e),this.dates.setSelectedDate(e),this.dates.resetDates(),this.panel.close(),this.onSelect(e)}}),this.yearpicker=new class{constructor(e){Object.assign(this,e),this.isSlide=!1}init(){this.yearpicker=this.create()}get(){return this.yearpicker}render(){this.destroy(),this.init()}create(){const e=document.createElement("div");e.classList.add("yearpicker");const t=document.createElement("div");t.classList.add("header"),e.appendChild(t);const a=new s({type:"button",ariaLabel:"Volver atras",buttonSize:"large",svgSize:"large",icon:i.get("arrow-left"),onClick:this.onGoBack});t.appendChild(a.get());const r=document.createElement("div");return r.classList.add("body"),e.appendChild(r),this.years.years.forEach((e=>{const t=document.createElement("div");t.classList.add("year"),r.appendChild(t);const s=document.createElement("button");e.isSelected&&s.classList.add("selected"),e.isToday&&s.classList.add("today"),s.type="button",s.textContent=e.year.getFullYear(),s.addEventListener("click",(()=>this.onSelectYear(e.year))),t.appendChild(s)})),this.observer=new MutationObserver((()=>{this.yearpicker.querySelector(".selected").scrollIntoView({block:"center"})})),this.observer.observe(document.querySelector(".datepicker .content"),{childList:!0}),e}destroy(){this.observer&&this.observer.disconnect(),this.yearpicker&&this.yearpicker.remove()}}({years:this.years,onGoBack:()=>{this.yearpicker.destroy(),this.daypicker.render(),this.panel.render(this.daypicker.get())},onSelectYear:e=>{this.yearpicker.destroy(),this.dates.setCurrentDateYear(e),this.dates.resetDates(),this.years.setSelectedYear(e),this.years.resetYears(),this.daypicker.destroy(),this.daypicker.render(),this.panel.render(this.daypicker.get())}})}get(){return this.inputDate.get()}getValue(){return this.inputDate.getValue()}setValue(e){this.inputDate.setValue(e),this.dates.setCurrentDate(e),this.dates.setSelectedDate(e),this.dates.resetDates()}}({label:{text:"Fecha",for:"date"},input:{name:"date",id:"date",value:v.date,readOnly:!0,format:"long"},error:y.date.length>0,message:y.date,onSelect:e=>{v.date=e,y.date=""}});L.appendChild(w.get())})();